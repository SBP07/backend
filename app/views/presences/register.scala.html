@(childForm: Form[models.formBindings.PresencesPost],
    children: List[Child],
    today: org.joda.time.LocalDate,
    shiftsToday: List[(ShiftType, Shift)])(implicit flash: Flash)
@import org.joda.time.LocalDate
@import helper._
@import helpers.DateTime.fmt

@implicitField = @{ FieldConstructor(bootstrap3FieldConstructorTemplate.f) }


@main("Registreer een nieuwe aanwezigheid") {
    <h2>Nieuwe registratie</h2>
    <p></p><em>Enkel activiteiten voor vandaag (@today.toString(fmt)) worden getoond (niet volledig waar voor de moment :)).</em></p>

    @helper.form(action = routes.Presences.savePresence, 'class -> "form-horizontal") {
        @select(field = childForm("childId"),
            options = (children.map(c => {
                c.id.getOrElse(-1).toString -> {c.firstName + " " + c.lastName}
            })), '_label -> "Kind", 'class -> "form-control selectpicker", Symbol("data-live-search") -> "true"
        )

        @views.html.bootstrap3CheckboxGroup(
            childForm("selectedShiftIds"),
            options = shiftsToday.map(a =>
                (a._2.id.getOrElse(-1L).toString, s"${a._2.date.toString(fmt)} ${a._1.mnemonic} (${a._2.place})")
            ).toSeq,
            '_label -> "Aanwezigheden"
        )

        @for(shift <- childForm.value.map(_.possibleShifts).getOrElse(Nil)) {
            @helper.input(childForm("possibleShiftIds[]"),
                '_label -> s"Hidden field, you should not be seeing this :) ${shift}",
                'class -> "form-control",
                'value -> shift.id.getOrElse(-1)
            ) { (id, name, value, args) =>
                <input type="hidden" name="@name" id="@id" @toHtmlArgs(args)>
            }(FieldConstructor(hiddenFieldConstructorTemplate.f), Lang.defaultLang)
        }

        <button type="submit" class="btn btn-primary">Opslaan</button>
    }
}
